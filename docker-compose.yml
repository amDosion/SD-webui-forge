version: "3.9"

services:
  webui:
    container_name: sd-webui-forge
    image: chuan1127/sd-webui-forge:latest
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      # === WebUI ç±»å‹ ===
      - UI=forge  # æˆ– auto

      # === è¿è¡Œå‚æ•°ï¼ˆå¯é€‰ï¼‰===
      - ARGS=--xformers --api --listen --enable-insecure-extension-access --theme dark

      # === ä¸‹è½½æ§åˆ¶ï¼ˆtrue / falseï¼‰===
      - ENABLE_DOWNLOAD=true                     # å¼€å¯æ‰€æœ‰ä¸‹è½½
      - ENABLE_DOWNLOAD_EXTS=true               # æ’ä»¶
      - ENABLE_DOWNLOAD_MODELS=true             # ä¸»æ¨¡å‹
      - ENABLE_DOWNLOAD_CONTROLNET=true         # ControlNet æ¨¡å‹
      - ENABLE_DOWNLOAD_VAE=true                # VAE æ¨¡å‹
      - ENABLE_DOWNLOAD_TEXT_ENCODERS=true      # Text Encoder æ¨¡å‹
      - ENABLE_DOWNLOAD_TRANSFORMERS=true       # ğŸ¤— Transformers åº“ï¼ˆç”¨äº SDXL / LLM ç­‰ï¼‰

      # === Tokenï¼ˆå¯é€‰ï¼‰===
      - HUGGINGFACE_TOKEN=your_hf_token_here
      - CIVITAI_API_TOKEN=your_civitai_token_here

    volumes:
      - ./outputs:/home/webui/outputs
      - ./models:/home/webui/models
      - ./cache:/home/webui/cache
      - ./custom:/app/custom  # ä½ å¯ä»¥æŒ‚è½½å…¶ä»–æ–‡ä»¶

    ports:
      - "7860:7860"

    restart: unless-stopped

    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

    runtime: nvidia  # å¦‚æœç”¨çš„æ˜¯æ—§ç‰ˆ Docker + nvidia-docker2 æ’ä»¶
